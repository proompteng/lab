syntax = "proto3";

package proompteng.jangar.v1;

option go_package = "github.com/proompteng/lab/services/jangar/internal/agentctlpb";

service AgentctlService {
  rpc GetServerInfo(GetServerInfoRequest) returns (GetServerInfoResponse);

  rpc ListAgents(ListAgentsRequest) returns (ListAgentsResponse);
  rpc GetAgent(GetAgentRequest) returns (GetAgentResponse);
  rpc ApplyAgent(ApplyAgentRequest) returns (ApplyAgentResponse);
  rpc DeleteAgent(DeleteAgentRequest) returns (DeleteAgentResponse);

  rpc ListImplementationSpecs(ListImplementationSpecsRequest) returns (ListImplementationSpecsResponse);
  rpc GetImplementationSpec(GetImplementationSpecRequest) returns (GetImplementationSpecResponse);
  rpc ApplyImplementationSpec(ApplyImplementationSpecRequest) returns (ApplyImplementationSpecResponse);
  rpc DeleteImplementationSpec(DeleteImplementationSpecRequest) returns (DeleteImplementationSpecResponse);
  rpc CreateImplementationSpec(CreateImplementationSpecRequest) returns (CreateImplementationSpecResponse);

  rpc ListImplementationSources(ListImplementationSourcesRequest) returns (ListImplementationSourcesResponse);
  rpc GetImplementationSource(GetImplementationSourceRequest) returns (GetImplementationSourceResponse);
  rpc ApplyImplementationSource(ApplyImplementationSourceRequest) returns (ApplyImplementationSourceResponse);
  rpc DeleteImplementationSource(DeleteImplementationSourceRequest) returns (DeleteImplementationSourceResponse);

  rpc ListMemories(ListMemoriesRequest) returns (ListMemoriesResponse);
  rpc GetMemory(GetMemoryRequest) returns (GetMemoryResponse);
  rpc ApplyMemory(ApplyMemoryRequest) returns (ApplyMemoryResponse);
  rpc DeleteMemory(DeleteMemoryRequest) returns (DeleteMemoryResponse);

  rpc ListAgentRuns(ListAgentRunsRequest) returns (ListAgentRunsResponse);
  rpc GetAgentRun(GetAgentRunRequest) returns (GetAgentRunResponse);
  rpc ApplyAgentRun(ApplyAgentRunRequest) returns (ApplyAgentRunResponse);
  rpc DeleteAgentRun(DeleteAgentRunRequest) returns (DeleteAgentRunResponse);

  rpc SubmitAgentRun(SubmitAgentRunRequest) returns (SubmitAgentRunResponse);
  rpc CancelAgentRun(CancelAgentRunRequest) returns (CancelAgentRunResponse);
  rpc StreamAgentRunLogs(StreamAgentRunLogsRequest) returns (stream StreamAgentRunLogsResponse);
}

message GetServerInfoRequest {}

message GetServerInfoResponse {
  string version = 1;
  string build_sha = 2;
  string build_time = 3;
  string service = 4;
}

message ListAgentsRequest {
  string namespace = 1;
  string label_selector = 2;
}

message ListAgentsResponse {
  string json = 1;
}

message GetAgentRequest {
  string namespace = 1;
  string name = 2;
}

message GetAgentResponse {
  string json = 1;
}

message ApplyAgentRequest {
  string namespace = 1;
  string manifest_yaml = 2;
}

message ApplyAgentResponse {
  string json = 1;
}

message DeleteAgentRequest {
  string namespace = 1;
  string name = 2;
}

message DeleteAgentResponse {
  bool ok = 1;
  string message = 2;
  string json = 3;
}

message ListImplementationSpecsRequest {
  string namespace = 1;
  string label_selector = 2;
}

message ListImplementationSpecsResponse {
  string json = 1;
}

message GetImplementationSpecRequest {
  string namespace = 1;
  string name = 2;
}

message GetImplementationSpecResponse {
  string json = 1;
}

message ApplyImplementationSpecRequest {
  string namespace = 1;
  string manifest_yaml = 2;
}

message ApplyImplementationSpecResponse {
  string json = 1;
}

message DeleteImplementationSpecRequest {
  string namespace = 1;
  string name = 2;
}

message DeleteImplementationSpecResponse {
  bool ok = 1;
  string message = 2;
  string json = 3;
}

message ImplementationSourceInput {
  string provider = 1;
  string external_id = 2;
  string url = 3;
}

message CreateImplementationSpecRequest {
  string namespace = 1;
  string text = 2;
  string summary = 3;
  ImplementationSourceInput source = 4;
}

message CreateImplementationSpecResponse {
  string json = 1;
}

message RuntimeConfigEntry {
  string key = 1;
  string value = 2;
}

message WorkloadSpecInput {
  string image = 1;
  string cpu = 2;
  string memory = 3;
}

message SubmitAgentRunRequest {
  string namespace = 1;
  string agent_name = 2;
  string implementation_name = 3;
  string runtime_type = 4;
  repeated RuntimeConfigEntry runtime_config = 5;
  repeated RuntimeConfigEntry parameters = 6;
  string idempotency_key = 7;
  WorkloadSpecInput workload = 8;
  string memory_ref = 9;
}

message SubmitAgentRunResponse {
  string resource_json = 1;
  string record_json = 2;
  bool idempotent = 3;
}

message CancelAgentRunRequest {
  string namespace = 1;
  string name = 2;
}

message CancelAgentRunResponse {
  bool ok = 1;
  string message = 2;
}

message ListImplementationSourcesRequest {
  string namespace = 1;
  string label_selector = 2;
}

message ListImplementationSourcesResponse {
  string json = 1;
}

message GetImplementationSourceRequest {
  string namespace = 1;
  string name = 2;
}

message GetImplementationSourceResponse {
  string json = 1;
}

message ApplyImplementationSourceRequest {
  string namespace = 1;
  string manifest_yaml = 2;
}

message ApplyImplementationSourceResponse {
  string json = 1;
}

message DeleteImplementationSourceRequest {
  string namespace = 1;
  string name = 2;
}

message DeleteImplementationSourceResponse {
  bool ok = 1;
  string message = 2;
  string json = 3;
}

message ListMemoriesRequest {
  string namespace = 1;
  string label_selector = 2;
}

message ListMemoriesResponse {
  string json = 1;
}

message GetMemoryRequest {
  string namespace = 1;
  string name = 2;
}

message GetMemoryResponse {
  string json = 1;
}

message ApplyMemoryRequest {
  string namespace = 1;
  string manifest_yaml = 2;
}

message ApplyMemoryResponse {
  string json = 1;
}

message DeleteMemoryRequest {
  string namespace = 1;
  string name = 2;
}

message DeleteMemoryResponse {
  bool ok = 1;
  string message = 2;
  string json = 3;
}

message ListAgentRunsRequest {
  string namespace = 1;
  string label_selector = 2;
}

message ListAgentRunsResponse {
  string json = 1;
}

message GetAgentRunRequest {
  string namespace = 1;
  string name = 2;
}

message GetAgentRunResponse {
  string json = 1;
}

message ApplyAgentRunRequest {
  string namespace = 1;
  string manifest_yaml = 2;
}

message ApplyAgentRunResponse {
  string json = 1;
}

message DeleteAgentRunRequest {
  string namespace = 1;
  string name = 2;
}

message DeleteAgentRunResponse {
  bool ok = 1;
  string message = 2;
  string json = 3;
}

message StreamAgentRunLogsRequest {
  string namespace = 1;
  string name = 2;
  bool follow = 3;
}

message StreamAgentRunLogsResponse {
  string stream = 1;
  string message = 2;
}
