apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: codex-spark-review-workspace
  # Rename for concurrent/manual runs if needed.
  namespace: agents
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: agents.proompteng.ai/v1alpha1
kind: AgentRun
metadata:
  # Rename for each manual run invocation to avoid conflicts with existing AgentRun names.
  name: codex-spark-review
  namespace: agents
spec:
  agentRef:
    name: codex-spark-review
  implementationSpecRef:
    name: codex-spark-review-step-v1
  parameters:
    repository: proompteng/lab
    base: main
    # supply per-run values when triggering a review/fix cycle (repository branch)
    head: ''
    issueNumber: ''
    issueTitle: ''
    issueUrl: ''
  ttlSecondsAfterFinished: 3600
  runtime:
    type: workflow
  workflow:
    steps:
      - name: review
        implementationSpecRef:
          name: codex-spark-review-step-v1
        parameters:
          stage: review
          base: main
      - name: fix
        implementationSpecRef:
          name: codex-spark-fix-step-v1
        parameters:
          stage: fix
          reviewPath: /agentworkspace/.agentrun/codex-spark-review/review-notes.md
          base: main
  workload:
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
    volumes:
      - name: review-workspace
        type: pvc
        claimName: codex-spark-review-workspace
        mountPath: /agentworkspace
  vcsRef:
    name: github
  vcsPolicy:
    required: true
    mode: read-write
  secrets:
    - github-token
