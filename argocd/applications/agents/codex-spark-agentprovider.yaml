apiVersion: agents.proompteng.ai/v1alpha1
kind: AgentProvider
metadata:
  name: codex-spark
spec:
  binary: /usr/local/bin/agent-runner
  argsTemplate: []
  envTemplate:
    CODEX_LOG_LEVEL: info
    NATS_URL: nats://nats.nats.svc.cluster.local:4222
    AGENT_PROVIDER_PATH: /root/.codex/provider-codex-spark.json
  inputFiles:
    - path: /root/.codex/config.toml
      content: |-
        model = "gpt-5.3-codex-spark"
        model_reasoning_summary = "none"
        model_reasoning_effort = "xhigh"
        model_verbosity = "medium"
        approval_policy = "never"
        sandbox_mode = "danger-full-access"
        web_search = "live"
        suppress_unstable_features_warning = true

        [features]
        undo = true
        enable_request_compression = true
        apply_patch_freeform = true
        unified_exec = true
        shell_snapshot = true
        steer = true
        multi_agent = true
        child_agents_md = true
        collaboration_modes = true
        responses_websockets = false

        [shell_environment_policy]
        ignore_default_excludes = true

        [projects."/workspace/lab"]
        trust_level = "trusted"

        [projects."/root"]
        trust_level = "trusted"
    - path: /root/.codex/provider-codex-spark.json
      content: |-
        {
          "name": "codex-spark",
          "binary": "/usr/local/bin/codex-implement",
          "argsTemplate": [
            "{{payloads.eventBodyPath}}"
          ],
          "envTemplate": {
            "WORKFLOW_STAGE": "{{parameters.stage}}",
            "CODEX_STAGE": "{{parameters.stage}}"
          }
        }
  outputArtifacts:
    - name: runner-log
      path: /workspace/.agent/runner.log
    - name: runner-status
      path: /workspace/.agent/status.json
