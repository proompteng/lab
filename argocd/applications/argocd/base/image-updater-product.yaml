apiVersion: argocd-image-updater.argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: product-image-updater
  namespace: argocd
spec:
  namespace: argocd
  commonUpdateSettings:
    updateStrategy: semver
  writeBackConfig:
    method: git:secret:argocd/image-updater-git-ssh
    gitConfig:
      repository: git@github.com:proompteng/lab.git
      branch: main:release/{{.SHA256}}
  applicationRefs:
    - namePattern: proompteng
      writeBackConfig:
        method: git:secret:argocd/image-updater-git-ssh
        gitConfig:
          repository: git@github.com:proompteng/lab.git
          branch: main:release/{{.SHA256}}
          writeBackTarget: kustomization:/argocd/applications/proompteng
      images:
        - alias: proompteng
          imageName: registry.ide-newton.ts.net/lab/proompteng:0.x
          manifestTargets:
            kustomize:
              name: registry.ide-newton.ts.net/lab/proompteng
    - namePattern: app
      writeBackConfig:
        method: git:secret:argocd/image-updater-git-ssh
        gitConfig:
          repository: git@github.com:proompteng/lab.git
          branch: main:release/{{.SHA256}}
          writeBackTarget: kustomization:/argocd/applications/app
      images:
        - alias: app
          imageName: registry.ide-newton.ts.net/lab/app:0.x
          manifestTargets:
            kustomize:
              name: registry.ide-newton.ts.net/lab/app
    - namePattern: cms
      writeBackConfig:
        method: git:secret:argocd/image-updater-git-ssh
        gitConfig:
          repository: git@github.com:proompteng/lab.git
          branch: main:release/{{.SHA256}}
          writeBackTarget: kustomization:/argocd/applications/cms
      images:
        - alias: cms
          imageName: registry.ide-newton.ts.net/lab/cms:0.x
          manifestTargets:
            kustomize:
              name: registry.ide-newton.ts.net/lab/cms
    - namePattern: docs
      writeBackConfig:
        method: git:secret:argocd/image-updater-git-ssh
        gitConfig:
          repository: git@github.com:proompteng/lab.git
          branch: main:release/{{.SHA256}}
          writeBackTarget: kustomization:/argocd/applications/docs
      images:
        - alias: docs
          imageName: registry.ide-newton.ts.net/lab/docs:0.x
          manifestTargets:
            kustomize:
              name: registry.ide-newton.ts.net/lab/docs
    - namePattern: dernier
      writeBackConfig:
        method: git:secret:argocd/image-updater-git-ssh
        gitConfig:
          repository: git@github.com:proompteng/lab.git
          branch: main:release/{{.SHA256}}
          writeBackTarget: kustomization:/argocd/applications/dernier
      images:
        - alias: dernier
          imageName: registry.ide-newton.ts.net/lab/dernier:latest
          manifestTargets:
            kustomize:
              name: registry.ide-newton.ts.net/lab/dernier
