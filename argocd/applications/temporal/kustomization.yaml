apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - load-balancer.yaml
  - load-balancer-frontend.yaml

helmCharts:
  - name: temporal
    repo: https://go.temporal.io/helm-charts
    version: 0.65.0
    releaseName: temporal
    namespace: temporal
    includeCRDs: true
    valuesInline:
      prometheus:
        enabled: false
      grafana:
        enabled: false
      elasticsearch:
        replicas: 3
        minimumMasterNodes: 2
        clusterHealthCheckParams: "wait_for_status=green&timeout=1s"
        # Persist ES data so Temporal visibility index survives node restarts
        persistence:
          enabled: true
        volumeClaimTemplate:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 5Gi
          storageClassName: rook-ceph-block
      schema:
        createDatabase:
          enabled: true
        setup:
          enabled: true
        update:
          enabled: true
      cassandra:
        persistence:
          enabled: true
          storageClass: rook-ceph-block
          accessMode: ReadWriteOnce
          size: 20Gi
        config:
          cluster_size: 3
          seed_size: 2
      web:
        # https://docs.temporal.io/references/web-ui-environment-variables
        additionalEnv:
          - name: TEMPORAL_CSRF_COOKIE_INSECURE
            value: "true"
