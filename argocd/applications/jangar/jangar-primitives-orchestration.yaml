apiVersion: orchestration.proompteng.ai/v1alpha1
kind: Orchestration
metadata:
  name: jangar-primitives
  namespace: jangar
spec:
  entrypoint: main
  steps:
    - name: agent-run
      kind: AgentRun
      agentRef:
        name: jangar-primitives-agent
      with:
        repository: proompteng/lab
        base: main
        head: codex/issue-2425-6cedebf4
        stage: implementation
    - name: tool-run
      kind: ToolRun
      dependsOn: [agent-run]
      toolRef:
        name: jangar-primitives-tool
      with:
        action: validate
    - name: memory-op
      kind: MemoryOp
      dependsOn: [tool-run]
      memoryRef: jangar-primitives
      with:
        operation: write
        payload: '{"event":"memory-op"}'
    - name: approval-gate
      kind: ApprovalGate
      dependsOn: [memory-op]
      policyRef: jangar-primitives-approval
    - name: signal-wait
      kind: SignalWait
      dependsOn: [approval-gate]
      with:
        signalRef: jangar-primitives-signal
        deliveryId: jangar-primitives-delivery
    - name: checkpoint
      kind: Checkpoint
      dependsOn: [signal-wait]
      memoryRef: jangar-primitives
      with:
        checkpointId: cp-001
        payload: '{"checkpoint":"cp-001"}'
    - name: sub-orchestration
      kind: SubOrchestration
      dependsOn: [checkpoint]
      orchestrationRef:
        name: jangar-primitives-sub
      with:
        parameters: '{"message":"hello"}'
