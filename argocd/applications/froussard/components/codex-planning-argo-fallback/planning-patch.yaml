- op: add
  path: /spec/dependencies/-
  value:
    eventName: github-codex-tasks
    eventSourceName: github-codex
    name: planning-event
    filters:
      data:
        - path: body.stage
          type: string
          value:
            - planning
- op: add
  path: /spec/triggers/-
  value:
    template:
      name: planning-workflow
      conditions: "planning-event"
      k8s:
        group: argoproj.io
        version: v1alpha1
        operation: create
        parameters:
          - dest: spec.arguments.parameters.0.value
            src:
              dependencyName: planning-event
              dataTemplate: '{{ .Input | toJson }}'
          - dest: spec.arguments.parameters.1.value
            src:
              dependencyName: planning-event
              dataTemplate: '{{ .Input.body | toJson }}'
        resource: workflows
        source:
          resource:
            apiVersion: argoproj.io/v1alpha1
            kind: Workflow
            metadata:
              generateName: github-codex-planning-
              namespace: argo-workflows
            spec:
              arguments:
                parameters:
                  - name: rawEvent
                    value: '{}'
                  - name: eventBody
                    value: '{}'
              workflowTemplateRef:
                name: github-codex-planning
