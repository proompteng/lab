---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: facteur-vector-cluster
  namespace: facteur
spec:
  imageName: registry.ide-newton.ts.net/lab/vecteur:18-trixie
  imagePullPolicy: Always
  instances: 3
  inheritedMetadata:
    annotations:
      reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
      reflector.v1.k8s.emberstack.com/reflection-allowed-namespaces: "pgadmin"
      reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
      reflector.v1.k8s.emberstack.com/reflection-auto-namespaces: "pgadmin"
  resources:
    requests:
      cpu: "1"
      memory: "512Mi"
    limits:
      cpu: "2"
      memory: "1Gi"
  storage:
    storageClass: rook-ceph-block
    size: 20Gi
  bootstrap:
    initdb:
      database: facteur_kb
      owner: facteur
      dataChecksums: true
      encoding: "UTF8"
      postInitApplicationSQL:
        - CREATE EXTENSION IF NOT EXISTS pgcrypto WITH SCHEMA public;
        - CREATE EXTENSION IF NOT EXISTS vector WITH SCHEMA public;
