loki:
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: boltdb-shipper
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  storageConfig:
    aws:
      s3: http://${OBS_S3_ENDPOINT}
      s3forcepathstyle: true
      bucketnames: ${OBS_S3_BUCKET}
      access_key_id: ${OBS_S3_ACCESS_KEY}
      secret_access_key: ${OBS_S3_SECRET_KEY}
      insecure: true
    boltdb_shipper:
      cache_location: /var/loki/index
      shared_store: s3
  compactor:
    replicas: 1
    persistence:
      enabled: true
      size: 20Gi
      storageClass: rook-ceph-block
  ingester:
    replicas: 2
    persistence:
      enabled: true
      claims:
        - name: data
          size: 20Gi
          storageClass: rook-ceph-block
  querier:
    replicas: 1
    persistence:
      enabled: true
      size: 10Gi
      storageClass: rook-ceph-block
  ruler:
    enabled: true
    kind: StatefulSet
    persistence:
      enabled: true
      size: 5Gi
      storageClass: rook-ceph-block

distributor:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

ingester:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

querier:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

queryFrontend:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

gateway:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

compactor:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket

ruler:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: OBS_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: accessKey
    - name: OBS_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: secretKey
    - name: OBS_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: endpoint
    - name: OBS_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: rook-ceph-rgw-loki
          key: bucket
