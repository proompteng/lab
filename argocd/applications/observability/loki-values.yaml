loki:
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: boltdb-shipper
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  storageConfig:
    aws:
      s3: http://observability-minio.minio.svc.cluster.local:9000
      s3forcepathstyle: true
      bucketnames: loki-data
      access_key_id: ${LOKI_ACCESS_KEY_ID}
      secret_access_key: ${LOKI_SECRET_ACCESS_KEY}
      insecure: true
    boltdb_shipper:
      cache_location: /var/loki/index
      shared_store: s3
  compactor:
    replicas: 1
    persistence:
      enabled: true
      size: 20Gi
      storageClass: rook-ceph-block
  ingester:
    replicas: 2
    persistence:
      enabled: true
      claims:
        - name: data
          size: 20Gi
          storageClass: rook-ceph-block
  querier:
    replicas: 1
    persistence:
      enabled: true
      size: 10Gi
      storageClass: rook-ceph-block
  ruler:
    enabled: true
    kind: StatefulSet
    persistence:
      enabled: true
      size: 5Gi
      storageClass: rook-ceph-block

distributor:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

ingester:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

querier:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

queryFrontend:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

gateway:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

compactor:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey

ruler:
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: LOKI_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiAccessKey
    - name: LOKI_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: observability-minio-credentials
          key: lokiSecretKey
