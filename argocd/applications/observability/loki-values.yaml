loki:
  command:
    - /usr/bin/loki
    - -config.file=/etc/loki/config/config.yaml
    - -config.expand-env=true
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: boltdb-shipper
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  storageConfig:
    aws:
      s3: ${LOKI_S3_ENDPOINT}
      s3forcepathstyle: true
      bucketnames: ${LOKI_S3_BUCKET}
      access_key_id: ${LOKI_S3_ACCESS_KEY}
      secret_access_key: ${LOKI_S3_SECRET_KEY}
      region: ${LOKI_S3_REGION}
      insecure: true
    boltdb_shipper:
      cache_location: /var/loki/index
      shared_store: s3
  compactor:
    replicas: 1
    persistence:
      enabled: true
      size: 20Gi
      storageClass: longhorn
    extraEnv: &rgwEnv
      - name: LOKI_S3_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: rook-ceph-rgw-loki
            key: accessKey
      - name: LOKI_S3_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: rook-ceph-rgw-loki
            key: secretKey
      - name: LOKI_S3_ENDPOINT
        valueFrom:
          secretKeyRef:
            name: rook-ceph-rgw-loki
            key: endpoint
      - name: LOKI_S3_BUCKET
        valueFrom:
          secretKeyRef:
            name: rook-ceph-rgw-loki
            key: bucket
      - name: LOKI_S3_REGION
        valueFrom:
          secretKeyRef:
            name: rook-ceph-rgw-loki
            key: region
    extraArgs:
      - -config.expand-env=true
  distributor:
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  ingester:
    replicas: 2
    persistence:
      enabled: true
      claims:
        - name: data
          size: 20Gi
          storageClass: longhorn
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  queryFrontend:
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  querier:
    replicas: 1
    persistence:
      enabled: true
      size: 10Gi
      storageClass: longhorn
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  read:
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  ruler:
    enabled: true
    kind: StatefulSet
    persistence:
      enabled: true
      size: 5Gi
      storageClass: longhorn
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  write:
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
  indexGateway:
    extraEnv: *rgwEnv
    extraArgs:
      - -config.expand-env=true
